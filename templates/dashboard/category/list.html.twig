{% extends 'dashboard/index.html.twig' %}

{% block title %}{% trans %}Mes catégories{% endtrans %}{% endblock %}

{% block body %}

    <section class="tree-categories-container container">
        <h1>{% trans %}Liste des catégories{% endtrans %}</h1>
        <form action="" class="form_category">
            <fieldset>
                <legend>{% trans %}Ajouter une catégorie{% endtrans %}</legend>
                    {{ form_start(category_form) }}
                        {{ form_row(category_form.label) }}
                        {{ form_row(category_form.parent) }}
                        {{ form_row(category_form.color) }}
                        <fieldset class="form-custom-colors">
                            <legend>Où Modifier les couleurs</legend>
                            <div class="custom-colors-container">
                                <div class="flex-equal">{{ form_row(category_form.bgColorPicker) }}</div>
                                <div class="flex-equal">{{ form_row(category_form.textColorPicker) }}</div>
                            </div>
                        </fieldset>
                    {{ form_end(category_form) }}
            </fieldset>
        </form>

        {% macro menu_categories(categories) %}
            {% import _self as macros %}
            {% for category in categories %}
                <ul>
                    <li class="cat-accordion-header">
                        <button class="cat-accordion-button_{{category.slug}}" type="button" aria-expanded="true"
                                style="color: {{category.color.codeText}}; background: {{category.color.codeBg}}"
                        >
                            {{ category.label }}
                            {% if category.subCategories|length > 0 %}
                                <i class="fas fa-chevron-down"></i>
                            {% endif %}
                        </button>
                    </li>
                    {% if category.subCategories|length > 0 %}
                        <div id="cat-accordion-sub_{{category.slug}}" style="display: none" class="cat-accordion-body">
                            {{ macros.menu_categories(category.subCategories) }}
                        </div>
                    {% endif %}
                </ul>
            {% endfor %}
        {% endmacro %}

        {% import _self as macros %}

        {{ macros.menu_categories(categories, 1) }}

    </section>

{% endblock %}

{% block js %}
    {{ parent() }}
    <script>
        window.onload = () => {
            let buttons = document.querySelectorAll("button[class*='cat-accordion-button']");
            for(let button of buttons) {
                const label = button.className.split('_')[1];
                button.addEventListener("click", function(){
                    const toggleNode = document.getElementById(`cat-accordion-sub_${label}`);
                    toggleNode.style.display = toggleNode.style.display === "none" ? "block" : "none";
                })
            }
        }
    </script>
{% endblock %}